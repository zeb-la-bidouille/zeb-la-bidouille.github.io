<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <script type='text/javascript'>

// E3  (± 40%) 100, 220, 470
// E6  (± 20%) 100, 150, 220, 330, 470, 680
// E12 (± 10%) 100, 120, 150, 180, 220, 270, 330, 390, 470, 560, 680, 820
// E24 (±  5%) 100, 110, 120, 130, 150, 160, 180, 200, 220, 240, 270, 300, 330, 360, 390, 430, 470, 510, 560, 620, 680, 750, 820, 910
//             [0]  [1]  [2]  [3]  [4]  [5]  [6]  [7]  [8]  [9] [10] [11] [12]  [13] [14] [15] [16] [17] [18] [19] [20] [21] [22] [23]
// E48 (±  2%)
// 100, 105, 110, 115, 121, 127, 133, 140, 147, 154, 162, 169, 178, 187, 196
// 205, 215, 226, 237, 249, 261, 274, 287
// 301, 316, 332, 348, 365, 383
// 402, 422, 442, 464, 487
// 511, 536, 562, 590
// 619, 649, 681
// 715, 750, 787
// 825, 866
// 909, 953
// 
// E96 (±  1%)
// 100, 102, 105, 107, 110, 113, 115, 118, 121, 124, 127, 130, 133, 137, 140, 143, 147, 150, 154, 158, 162, 165, 169, 174, 178, 182, 187, 191, 196
// 200, 205, 210, 215, 221, 226, 232, 237, 243, 249, 255, 261, 267, 274, 280, 287, 294
// 301, 309, 316, 324, 332, 340, 348, 357, 365, 374, 383, 392
// 402, 412, 422, 432, 442, 453, 464, 475, 487, 499
// 511, 523, 536, 549, 562, 576, 590
// 604, 619, 634, 649, 665, 681, 698
// 715, 732, 750, 768, 787
// 806, 825, 845, 866, 887
// 909, 931, 953, 976

      var E24 = [ 100, 110, 120, 130, 150, 160, 180, 200, 220, 240, 270, 300, 330, 360, 390, 430, 470, 510, 560, 620, 680, 750, 820, 910 ]
      var E96 = [ 100, 102, 105, 107, 110, 113, 115, 118, 121, 124, 127, 130, 133, 137, 140, 143, 147, 150, 154, 158, 162, 165, 169, 174, 178, 182, 187, 191, 196,
                  200, 205, 210, 215, 221, 226, 232, 237, 243, 249, 255, 261, 267, 274, 280, 287, 294,
                  301, 309, 316, 324, 332, 340, 348, 357, 365, 374, 383, 392,
                  402, 412, 422, 432, 442, 453, 464, 475, 487, 499,
                  511, 523, 536, 549, 562, 576, 590,
                  604, 619, 634, 649, 665, 681, 698,
                  715, 732, 750, 768, 787,
                  806, 825, 845, 866, 887,
                  909, 931, 953, 976 ];


      function elderByTagName(me, tagName, myself) {
        if (me.parentNode === undefined) return undefined;
        if (me.parentNode.tagName == tagName) return me.parentNode;
        return elderByTagName(me.parentNode, tagName);
      }
      function meOrElderByTagName(me, tagName) {
        if (me.tagName == tagName) return me;
        return elderByTagName(me, tagName);
      }

      function elderByClassName(me, className) {
        if (me.parentNode === undefined) return undefined;
        if (me.parentNode.classList.contains(className)) return me.parentNode;
        return elderByClassName(me.parentNode, className);
      }
      function meOrElderByClassName(me, className) {
        if (me.classList.contains(className)) return me;
        return elderByClassName(me, className);
      }

      function meOrElderByPosition(me, position) {
        if (position <= 0) return me;
        if (me.parentNode === undefined) return undefined;
        return meOrElderByPosition(me.parentNode, position-1);
      }

      function rkm(value, precision) {
        var l = ["R", "K", "M", "G"];
        var v = value;
        while (v >= 1000) { v /= 1000; l.shift(); }
             if (v <   1) v = v.toFixed(precision    );
        else if (v <  10) v = v.toFixed(precision - 1);
        else if (v < 100) v = v.toFixed(precision - 2);
        if (! (v+"").match(/\./)) v = v+'.';
        return v.replace(/^0./, l[0]).replace('.', l[0]);
      }

      function setBand(band, value) {
        var letter = { "band1":"r", "band2":"r", "band3":"r", "band4":"m", "band5":"t" }[band.id];
        var node = meOrElderByPosition(band, band.id == "band5" ? 1 : 0);
        for (let cls of node.classList) if (cls[0] == letter) node.classList.remove(cls);
        node.classList.add(letter+value);
        band.querySelector("span").innerHTML = (value+"").replace(/\./, ",");
      }
      function setAllBands(values) {
        var bands = document.querySelectorAll(".band");
        values.forEach( function (value, i) {
          setBand(bands[i], value);
        });
      }

      function closeInSeries(value) {
        value = parseInt(value+"", 10);
        if (value === undefined) return;
        if (value <= 0) return;
        while (value < 100) value *= 10;

        var indices = [24, 24, 96, 96];
        while (value <= E24[indices[0]-2]) indices[0] -= 2;
        while (value <= E24[indices[1]-1]) indices[1] -= 1;
        while (value <= E96[indices[3]-1]) indices[3] -= 1;

        console.log(indices, E24[indices[0]], E24[indices[1]], E96[indices[3]])

        return indices;

        /*
// E3  (± 40%) 100,                                    220,                                    470
// E6  (± 20%) 100,                150,                220,                330,                470,                680
// E12 (± 10%) 100,      120,      150,      180,      220,      270,      330,      390,      470,      560,      680,      820
// E24 (±  5%) 100, 110, 120, 130, 150, 160, 180, 200, 220, 240, 270, 300, 330, 360, 390, 430, 470, 510, 560, 620, 680, 750, 820, 910
//             [0]  [1]  [2]  [3]  [4]  [5]  [6]  [7]  [8]  [9] [10] [11] [12]  [13] [14] [15] [16] [17] [18] [19] [20] [21] [22] [23]
        */
      }

      function onEvt(evt) { 
        if (evt.type == 'load' && evt.target == document) { 

          var frag = document.createDocumentFragment();
          for(let v of E24) {
            var span = document.createElement("SPAN");
            span.innerHTML = v + " ";
            frag.appendChild(span); 
          }
          document.getElementById("serie").appendChild(frag);

          return;
        }

        if (evt.type == 'click') { 
          if (evt.target !== undefined) {
            var anch = meOrElderByTagName(evt.target, "A");
            if (anch === undefined) return;
            var band = elderByClassName(anch, "band");
            if (band === undefined) return;
            setBand(band, anch.className.replace(/^[rmt]/, "").replace(/^_/, "0."));
          }
          
          var values = [];
          document.querySelectorAll(".band>span").forEach( span => values.push(1 * span.innerHTML.replace(/,/, ".")));

          var num_value = values[0] * 10 + values[1];
          if (values[4] < 2) num_value = num_value * 10 + values[2];
          num_value *= Math.pow(10, values[3]);
          
          var mul = ["", "k", "M", "G"];
          var dec_value = num_value;
          while (dec_value >= 1000) { dec_value /= 1000; mul.shift(); }
          mul = mul[0];

          rkm_value = dec_value.toFixed( (values[4] < 2 ? 2 : 1) + (values[4] == -2 ? 1 : 0) );

       // document.getElementById("value").innerHTML = (num_value+"").replace(/\./, ",") + " Ω<br/>" + 
       //                                              (dec_value+"").replace(/\./, ",") + " " + mul + "Ω<br/>" +
       //                                               rkm(num_value, 2);
          var inputs;
          inputs = document.querySelectorAll("#value>input");
          inputs[0].value = (num_value+"").replace(/\./, ",") + " Ω";
          inputs[1].value = (dec_value+"").replace(/\./, ",") + " " + mul + "Ω";
          inputs[2].value = rkm(num_value, 2);

          //closeInSeries
          var result = closeInSeries(num_value);
          inputs = document.querySelectorAll("#close>input");
          inputs[0].value = result[2];
          inputs[1].value = result[3];
          inputs[2].value = result[4];
          inputs[3].value = result[5];


          return;
        }

        console.log('nothing to do with:', evt ); 
      }

      function compute(a) {

        // 220
        // 2.2
        // 2,2
        // 2.2K
        // 2,2K
        // 2.2 K
        // 2,2 K
        // 2K2

        var num_value;
        var str_value = document.forms[0][0].value;
        str_value = str_value.replace(/^\s+/, "").replace(/\s+$/, "");

        var a;
        if (a = str_value.match(/^(\d+(?:\.\d*)?)$/)) {
          num_value = parseFloat(a[1]);
        }
        else if (a = str_value.match(/^(\.\d+)$/)) {
          num_value = parseFloat(a[1]);
        }
        else if (a = str_value.match(/^(\d+(?:\.\d*)?)\s+([kMG])$/i)) {
          num_value = parseFloat(a[1]);
               if (a[2].toLowerCase() == 'k') num_value *=       1000;
          else if (a[2].toUpperCase() == 'M') num_value *=    1000000;
          else if (a[2].toUpperCase() == 'G') num_value *= 1000000000;
        }
        else if (a = str_value.match(/^(\d+)([RKMG])(\d*)/i)) {
          num_value = parseFloat(a[1]+'.'+a[3]);
               if (a[2].toLowerCase() == 'k') num_value *=       1000;
          else if (a[2].toUpperCase() == 'M') num_value *=    1000000;
          else if (a[2].toUpperCase() == 'G') num_value *= 1000000000;
        }
        else if (a = str_value.match(/^R(\d+)/i)) {
          num_value = parseFloat('.'+a[1]);
        }

        if (num_value == 0) return;

        var n = num_value;
        var i = 0;
        while (n <  100) { n *= 10; i--; }
        while (n > 1000) { n /= 10; i++; }
        n = parseInt(n, 10);

        var prec3 = [];
        prec3[0] = parseInt( n        / 100, 10);
        prec3[1] = parseInt((n % 100) /  10, 10);
        prec3[2] = parseInt( n %  10,        10);

        setAllBands([ prec3[0], prec3[1], prec3[2], prec3[2] > 0 ? i : i+1, prec3[2] > 0 ? 1 : 5 ]);
        onEvt({ type: 'click' });
      }


    </script>
    <style type="text/css">

      .r0, .m0                                      { background-color:#000000; color:#ffffff; }
      .r1, .m1,  .t1  >#band5, #band5>.menu>a.t1    { background-color:#844d00; color:#ffffff; }
      .r2, .m2,  .t2  >#band5, #band5>.menu>a.t2    { background-color:#ff0000; color:#ffffff; }
      .r3, .m3                                      { background-color:#ff8000; color:#000000; }
      .r4, .m4                                      { background-color:#ffff00; color:#000000; }
      .r5, .m5,  .t_5 >#band5, #band5>.menu>a.t_5   { background-color:#00ff00; color:#000000; }
      .r6, .m6,  .t_25>#band5, #band5>.menu>a.t_25  { background-color:#0000ff; color:#ffffff; }
      .r7, .m7,  .t_1 >#band5, #band5>.menu>a.t_1   { background-color:#8000ff; color:#ffffff; }
      .r8, .m8,  .t_05>#band5, #band5>.menu>a.t_05  { background-color:#666666; color:#ffffff; }
      .r9, .m9                                      { background-color:#ffffff; color:#000000; }
           .m-1, .t5  >#band5, #band5>.menu>a.t5    { background-color:#d4af37; color:#000000; }
           .m-2, .t10 >#band5, #band5>.menu>a.t10   { background-color:#A9A9A9; color:#000000; }

      .band                    { display:inline-block; text-align:center; width:60px; height:20px; padding:20px 4px; margin:0 8px; vertical-align:bottom; position:relative; }
      
      
      .t2  >#band3             { display:none; }
      .t5  >#band3             { display:none; }
      .t10 >#band3             { display:none; }

      #band5                   { margin-left:24px; }

      #band4 .menu span        { display:inline-block; }
      #band4 .menu span._1     { width:2em; text-align:left; }
      #band4 .menu span._2     { width:3em; text-align:right; padding-right:0.5em; }

      #band4>span:before       { content:"10 "; font-size:smaller; position:relative; top:4px; }
      #band5>span:after        { content:"%"; }

      .menu                    { display:none; position:absolute; top:-10px; right:-40px; box-shadow:0 0 3px black; }
      .menu>a                  { display:block; padding:1px 2px; min-width:40px; }

      .band:hover>.menu        { display:block; z-index:1; }

      #main                    { display:inline-block; }
      #resistor                { border:1px solid gray; display:inline-block; background:#42c8f4; padding:0 16px; font-family:sans-serif; }
      #value                   { text-align:center; margin-top:30px; }

      #serie                   { font-size:x-small; }

    </style>
  </head>
  <!-- × Ω --> 
  <body onload="onEvt(event);">
    <h1>résistance</h1>
    <div id="main">
      <div id="resistor" class="t5">
        <div id="band1" class="band r2"><span>2</span><!-- 
          --><div class="menu"><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r0">0</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r1">1</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r2">2</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r3">3</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r4">4</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r5">5</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r6">6</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r7">7</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r8">8</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r9">9</a></div></div><!--
        --><div id="band2" class="band r2"><span>2</span><!-- 
          --><div class="menu"><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r0">0</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r1">1</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r2">2</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r3">3</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r4">4</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r5">5</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r6">6</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r7">7</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r8">8</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r9">9</a></div></div><!--
     --><div id="band3" class="band r0"><span>0</span><!-- 
          --><div class="menu"><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r0">0</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r1">1</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r2">2</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r3">3</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r4">4</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r5">5</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r6">6</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r7">7</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r8">8</a><!-- 
            --><a href="javascript:void(0);" onclick="onEvt(event);" class="r9">9</a></div></div><!--
     --><div id="band4" class="band m1"><span>1</span><!--
        --><div class="menu"><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m-2"></span><span class="_2">  0,01 </span><span class="_1">10<sup>-2</sup> </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m-1"></span><span class="_2">  0,1  </span><span class="_1">10<sup>-1</sup> </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m0" ></span><span class="_2">  1    </span><span class="_1">10<sup>0</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m1" ></span><span class="_2"> 10    </span><span class="_1">10<sup>1</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m2" ></span><span class="_2">100    </span><span class="_1">10<sup>2</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m3" ></span><span class="_2">  1k   </span><span class="_1">10<sup>3</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m4" ></span><span class="_2"> 10k   </span><span class="_1">10<sup>4</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m5" ></span><span class="_2">100k   </span><span class="_1">10<sup>5</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m6" ></span><span class="_2">  1M   </span><span class="_1">10<sup>6</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m7" ></span><span class="_2"> 10M   </span><span class="_1">10<sup>7</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m8" ></span><span class="_2">100M   </span><span class="_1">10<sup>8</sup>  </a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="m9" ></span><span class="_2">  1G   </span><span class="_1">10<sup>9</sup>  </a></div></div><!--
     --><div id="band5" class="band"   ><span>5</span><!--
        --><div class="menu"><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t10" >10%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t5"  >5%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t1"  >1%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t2"  >2%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t_5" >0.5%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t_25">0.25%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t_1" >0.1%</a><!--
          --><a href="javascript:void(0);" onclick="onEvt(event);" class="t_05">0.05%</a></div></div><!--
     --></div>
      <div id="value">
        <input value="220 Ω"/><br/>
        <input value="220 Ω"/><br/>
        <input value="220"/><br/>
      </div>

      <form action="javascript:compute(event)">
        <input /><input type="submit" value="calculer" />
      </form>

      <div id="close">
        E12 <input value="220"/> (10%)<br/>
        E24 <input value="220"/> (5%)<br/>
        E48 <input value="220"/> (2%)<br/>
        E96 <input value="220"/> (1%)<br/>
      </div>
      <div id="serie">
      </div>
    </div>
  </body>
</html>
